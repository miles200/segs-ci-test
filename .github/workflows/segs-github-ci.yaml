
name: SEGS-CI

on:
  pull_request:
    branches: [ master ]

env:
  BUILD_TYPE:  Debug
  QT_VERSION:  "5.15.2"
  QT_WIN_TARGET_ARCHITECTURE:  "win64_msvc2019_64"

jobs:
  build-windows:
    runs-on: windows-latest
    steps:
    - uses: actions/checkout@v3
    
    - name: Install Qt
      uses: jurplel/install-qt-action@v2.14.0
      with:
        host: windows
        target: desktop
        version: ${{ env.QT_VERSION }}
        arch: ${{ env.QT_WIN_TARGET_ARCHITECTURE }}
        dir: "${{ github.workspace }}/qt"
        install-deps: "true"

    - name: Configure CMake
      env:
        CMAKE_PREFIX_PATH: ${{ env.Qt5_Dir }}
      run: cmake -B ${{ github.workspace }}/build -DCMAKE_BUILD_TYPE=${{ env.BUILD_TYPE }}

    - name: Build
      run: cmake --build ${{ github.workspace }}/build --config ${{ env.BUILD_TYPE }}

  build-linux:
    runs-on: ubuntu-latest
    steps:
    - uses: actions/checkout@v3

    - name: Install Qt
      uses: jurplel/install-qt-action@v2.14.0
      with:
        host: linux
        target: desktop
        version: ${{ env.QT_VERSION }}
        dir: "${{ github.workspace }}/qt"
        install-deps: "true"

    - name: Configure CMake
      env:
        CMAKE_PREFIX_PATH: ${{ env.Qt5_Dir }}
        CXX: "/usr/bin/clang++"
      run: cmake -B ${{ github.workspace }}/build -DCMAKE_BUILD_TYPE=${{ env.BUILD_TYPE }}

    - name: Build
      run: cmake --build ${{ github.workspace }}/build --config ${{ env.BUILD_TYPE }}

  build-macos:
    runs-on: macos-latest
    steps:
    - uses: actions/checkout@v3

    - name: Install Qt
      uses: jurplel/install-qt-action@v2.14.0
      with:
        host: mac
        target: desktop
        version: ${{ env.QT_VERSION }}
        dir: "${{ github.workspace }}/qt"
        install-deps: "true"
    
    #- name: Install Clang # MacOS XCode version of AppleClang does not include needed module support CLANG ALREADY INSTALLED???
    #  run: |
    #    brew update
    #    brew install llvm

    - name: Configure CMake
      env: 
        CMAKE_PREFIX_PATH: ${{ env.Qt5_Dir }}
        C: "/usr/local/opt/llvm/bin/clang"
        CXX: "/usr/local/opt/llvm/bin/clang++" # Point to Clang instead of AppleClang. AppleClang does not include needed module support
      run: cmake -B ${{ github.workspace }}/build -DCMAKE_BUILD_TYPE=${{ env.BUILD_TYPE }}

    - name: Build
      run: cmake --build ${{ github.workspace }}/build --config ${{ env.BUILD_TYPE }}






